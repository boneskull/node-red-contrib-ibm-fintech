<script>
RED.nodes.registerType('portfolio-read', {
  category: 'fintech',
  defaults: {
    name: {
      value: null
    },
    service: {
      type: 'investment-portfolio'
    },
    portfolioName: {
      value: null
    },
    date: {
      value: null
    },
    time: {
      value: null
    },
    limit: {
      value: 1
    },
    sort: {
      value: 'asc'
    },
    hasKey: {
      value: ''
    },
    hasKeyValue: {
      value: null
    },
    hasNoKey: {
      value: ''
    },
    selector: {
      value: '',
      validate: function (v) {
        if (!v) {
          return true;
        }
        try {
          JSON.parse(v);
          return true;
        } catch (ignored) {
          return false;
        }
      }
    }
  },
  inputs: 1,
  outputs: 1,
  color: '#85bb65',
  paletteLabel: 'portfolio',
  label: function () {
    return this.name || this.portfolioName || 'portfolio';
  },
  oneditprepare: function () {
    this.editor = RED.editor.createEditor({
      id: 'node-input-selector-editor',
      mode: 'ace/mode/json',
      value: $('#node-input-selector').val()
    });
  }
});
</script>

<script type="text/x-red" data-template-name="portfolio-read">
  <div class="form-row">
    <label for="node-input-service"><i class="fa fa-bookmark"></i> Service</label>
    <input type="text" id="node-input-service"/>
  </div>
  <div class="form-row">
    <label for="node-input-portfolioName"><i class="fa fa-book"></i> Portfolio</label>
    <input type="text" id="node-input-portfolioName" placeholder="(from topic)"/>
  </div>
  <div class="form-row">
    <label for="node-input-date"><i class="fa fa-calendar"></i> After Date</label>
    <input type="date" id="node-input-date"/>
  </div>
  <div class="form-row">
    <label for="node-input-time"><i class="fa fa-clock-o"></i> Time</label>
    <input type="time" id="node-input-time"/>
  </div>
  <div class="form-row">
    <label for="node-input-hasKey"><i class="fa fa-clock-o"></i> Has Key(s)</label>
    <input type="text" id="node-input-hasKey"/>
  </div>
  <div class="form-row" style="position: relative; margin-bottom: 0px;">
    <label for="node-input-selector"><i class="fa fa-file-code-o"></i> Selector (JSON)</label>
    <input type="hidden" id="node-input-template" autofocus="autofocus">
  </div>
  <div class="form-row node-text-editor-row">
      <div style="height: 250px; min-height:150px;" class="node-text-editor" id="node-input-selector-editor" ></div>
  </div>
  <div class="form-row">
    <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
    <input type="text" id="node-input-name" placeholder="Name"/>
  </div>
</script>
